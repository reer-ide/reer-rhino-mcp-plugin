<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        x:Class="ReerRhinoMCPPlugin.UI.MCPControlPanel"
        Title="Rhino MCP Control Panel"
        Width="600"
        Height="800"
        MinWidth="500"
        MinHeight="600"
        WindowStartupLocation="CenterScreen"
        Icon="/Assets/plugin-utility.ico">

  <Window.Styles>
    <!-- Simple Card Style -->
    <Style Selector="Border.Card">
      <Setter Property="Background" Value="{DynamicResource SystemRegionBrush}" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="Margin" Value="8,4" />
      <Setter Property="Padding" Value="16" />
      <Setter Property="BorderBrush" Value="{DynamicResource SystemBaseMediumLowColorBrush}" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>
    
    <Style Selector="TextBlock.Title">
      <Setter Property="FontSize" Value="16" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="Margin" Value="0,0,0,8" />
    </Style>
    
    <Style Selector="TextBlock.Label">
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="FontSize" Value="12" />
      <Setter Property="Margin" Value="0,0,8,0" />
      <Setter Property="Foreground" Value="{DynamicResource SystemBaseMediumColorBrush}" />
    </Style>
    
    <Style Selector="TextBlock.Value">
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="FontSize" Value="14" />
    </Style>
    
    <Style Selector="Button.Primary">
      <Setter Property="MinWidth" Value="100" />
      <Setter Property="Margin" Value="4" />
      <Setter Property="Padding" Value="12,8" />
    </Style>
    
    <Style Selector="Button.Secondary">
      <Setter Property="MinWidth" Value="80" />
      <Setter Property="Margin" Value="4" />
      <Setter Property="Padding" Value="8,6" />
    </Style>
  </Window.Styles>

  <ScrollViewer>
    <StackPanel Margin="8">
      
      <!-- Header -->
      <Border Classes="Card" Margin="0,0,0,8">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          
          <StackPanel Grid.Column="0" VerticalAlignment="Center">
            <TextBlock Text="Rhino MCP Plugin" 
                       FontSize="20" 
                       FontWeight="Bold" />
            <TextBlock Text="Model Context Protocol Bridge for Rhino 3D" 
                       FontSize="13" 
                       Foreground="{DynamicResource SystemBaseMediumColorBrush}" />
          </StackPanel>
          
          <Button Grid.Column="1" 
                  Classes="Secondary"
                  Command="{Binding OpenSettingsCommand}"
                  Content="Settings" />
        </Grid>
      </Border>

      <!-- Connection Status -->
      <Border Classes="Card" Margin="0,0,0,8">
        <StackPanel>
          <Grid Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" 
                       Classes="Title"
                       Text="Connection Status" />
            
            <Border Grid.Column="1" 
                    Background="{Binding StatusColor}"
                    CornerRadius="12"
                    Padding="8,4">
              <TextBlock Text="{Binding ConnectionStatusText}" 
                         Foreground="White"
                         FontSize="12"
                         FontWeight="Medium" />
            </Border>
          </Grid>
          
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0">
              <TextBlock Classes="Label" Text="Port:" />
              <TextBlock Classes="Value" Text="{Binding CurrentPort}" />
            </StackPanel>
            
            <StackPanel Grid.Column="1">
              <TextBlock Classes="Label" Text="Clients:" />
              <TextBlock Classes="Value" Text="{Binding ClientCount}" />
            </StackPanel>
            
            <StackPanel Grid.Column="2">
              <TextBlock Classes="Label" Text="Uptime:" />
              <TextBlock Classes="Value" Text="{Binding Uptime}" />
            </StackPanel>
          </Grid>
        </StackPanel>
      </Border>

      <!-- Server Control -->
      <Border Classes="Card" Margin="0,0,0,8">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          
          <TextBlock Grid.Column="0" 
                     Classes="Title"
                     Text="Server Control"
                     VerticalAlignment="Center" />
          
          <StackPanel Grid.Column="1" Orientation="Horizontal">
            <Button Classes="Primary"
                    Command="{Binding StartServerCommand}"
                    IsEnabled="{Binding IsDisconnected}"
                    IsVisible="{Binding IsDisconnected}"
                    Content="▶ Start Server" />
            
            <Button Classes="Primary"
                    Command="{Binding StopServerCommand}"
                    IsEnabled="{Binding IsConnected}"
                    IsVisible="{Binding IsConnected}"
                    Content="⏹ Stop Server" />
            
            <Button Classes="Primary"
                    IsEnabled="{Binding !IsLoading}"
                    IsVisible="{Binding IsLoading}"
                    Content="⏳ Loading..." />
          </StackPanel>
        </Grid>
      </Border>

      <!-- Activity Log -->
      <Border Classes="Card" Margin="0,0,0,8">
        <StackPanel>
          <Grid Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" 
                       Classes="Title"
                       Text="Activity Log" />
            
            <Button Grid.Column="1" 
                    Classes="Secondary"
                    Command="{Binding ClearLogCommand}"
                    Content="Clear" />
          </Grid>
          
          <Border BorderBrush="{DynamicResource SystemBaseMediumLowColorBrush}" 
                  BorderThickness="1" 
                  CornerRadius="4"
                  Height="300">
            <ListBox ItemsSource="{Binding LogEntries}"
                     Background="Transparent">
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <Border Padding="8,4" 
                          Margin="0,1">
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                      </Grid.ColumnDefinitions>
                      
                      <TextBlock Grid.Column="0" 
                                 Text="{Binding Timestamp}" 
                                 FontSize="11" 
                                 FontFamily="Consolas"
                                 Foreground="{DynamicResource SystemBaseMediumColorBrush}"
                                 VerticalAlignment="Top"
                                 Margin="0,0,8,0" />
                      
                      <Border Grid.Column="1" 
                              Background="{Binding LevelColor}"
                              CornerRadius="2"
                              Padding="4,2"
                              Margin="0,0,8,0">
                        <TextBlock Text="{Binding Level}" 
                                   FontSize="10"
                                   FontWeight="Bold"
                                   Foreground="White" />
                      </Border>
                      
                      <TextBlock Grid.Column="2" 
                                 Text="{Binding Message}"
                                 FontSize="12"
                                 FontFamily="Consolas"
                                 TextWrapping="Wrap"
                                 VerticalAlignment="Top" />
                    </Grid>
                  </Border>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </Border>
        </StackPanel>
      </Border>

      <!-- Footer -->
      <Border Classes="Card">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          
          <TextBlock Grid.Column="0" 
                     Text="© 2024 reer, inc. - Rhino MCP Plugin v1.0"
                     FontSize="11"
                     Foreground="{DynamicResource SystemBaseMediumColorBrush}"
                     VerticalAlignment="Center" />
          
          <Button Grid.Column="1" 
                  Classes="Secondary"
                  Command="{Binding OpenDocumentationCommand}"
                  Content="📖 Docs"
                  Margin="4,0" />
          
          <Button Grid.Column="2" 
                  Classes="Secondary"
                  Command="{Binding OpenGitHubCommand}"
                  Content="🔗 GitHub"
                  Margin="4,0,0,0" />
        </Grid>
      </Border>

    </StackPanel>
  </ScrollViewer>
</Window>